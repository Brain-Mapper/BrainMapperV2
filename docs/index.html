<!DOCTYPE html>
<html>
  <head>
    <title>User manual</title>
	<link rel="stylesheet" type="text/css" href="style.css">
  <link rel="icon" href="imgs/logo.png">
  </head>
  <body>

  <header class="w3-container w3-center w3-padding-32">
    <div class="row">
      <div class="column-h">
          <img src="imgs/logo.png" style="width:8%">
      </div>
      <div class="column-h">
        <h1><b>USER MANUAL</b></h1>
    	  <p>Welcome to the user manual for the <span class="w3-tag">BrainMapper</span> software.</p>
      </div>
    </div>
	</header>
<div class="row">
  <div class="column-left">
    <div class="w3-card w3-margin w3-margin-top">
      <div id="toc_container">
    	<p class="toc_title">Contents</p>
    	<ul class="toc_list">
    	   <li><a href="index.html#Global_presentation"><strong>1 Global presentation</strong></a></li>

        <ul>
           <li><small><a href="index.html#usecase">1.1 Software usecase</a></small></li>
           <li><small><a href="index.html#installation">1.2 BrainMapper installation</a></small></li>
              <ul>
                <li><small><a href="index.html#windows">1.2.1 Windows</a></small></li>
                  <ul>
                      <li><small><a href="index.html#executable">1.2.1.1 Executable file</a></small></li>
                      <li><small><a href="index.html#install_windows">1.2.1.2 Installation</a></small></li>
                  </ul>
                <li><small><a href="index.html#mac">1.2.2 OSX/Mac</a></small></li>
                <li><small><a href="index.html#ubuntu">1.2.3 Ubuntu/GNU/Linux</a></small></li>
                <li><small><a href="index.html#virtual_envir">1.2.4 Virtual environment</a></small></li>
                <li><small><a href="index.html#dependancies">1.2.5 Dependencies</a></small></li>
              </ul>

         </ul>

    	   <li><a href="NIfTI_handling.html"><strong>2 NIfTI Handling</strong></a></li>
         <ul>
           <li><a href="NIfTI_handling.html#set">2.1 Set</a></li>
           <ul>
             <li><small><a href="NIfTI_handling.html#new_set">2.1.1 Create a new set</a></small></li>
             <li><small><a href="NIfTI_handling.html#delete_set">2.1.2 Delete a set</a></small></li>
             <li><small><a href="NIfTI_handling.html#rename_set">2.1.3 Rename a set</a></small></li>
             <li><small><a href="NIfTI_handling.html#add_sub_set">2.1.4 Add a subset</a></small></li>
           </ul>
         <li><a href="NIfTI_handling.html#collection">2.2 Collection</a></li>
           <ul>
           <li><small><a href="NIfTI_handling.html#new_collection">2.2.1 Create a new collection</a></small></li>
           <li><small><a href="NIfTI_handling.html#select">2.2.2 Select collections</a></small></li>
           </ul>
         <li><a href="NIfTI_handling.html#edit">2.3 Edit collections</a></li>
          <ul>
             <li><small><a href="NIfTI_handling.html#select_coll">2.3.1 Select a collection to edit</a></small></li>
             <li><small><a href="NIfTI_handling.html#rename_coll">2.3.2 Rename a collection</a></small></li>
             <li><small><a href="NIfTI_handling.html#add_images">2.3.3 Add images</a></small></li>
             <li><small><a href="NIfTI_handling.html#remove_images">2.3.4 Remove an image from a collection</a></small></li>
             <li><small><a href="NIfTI_handling.html#show_image">2.3.5 Show an image</a></small></li>
             <li><small><a href="NIfTI_handling.html#show_coll">2.3.6 Show a collection</a></small></li>
             <li><small><a href="NIfTI_handling.html#del_coll">2.3.7 Delete a collection</a></small></li>
           </ul>
          </ul>
            <li><a href="clustering.html"><strong>3 Clustering</strong></a></li>
            <ul>

              <li><a href="clustering.html#data">3.1 Data extraction for clustering</a></li>
                <ul>
                 <li><a href="clustering.html#extract"><small>3.1.1 How data are extracted</small></a></li>
                 <li><a href="clustering.html#all_points"><small>3.1.2 Use all points of an image</small></a></li>
                 <li><a href="clustering.html#as_centroid"><small>3.1.3 Use the image's points centroid as data</small></a></li>
                 </ul>

               <li><a href="clustering.html#methods">3.2 Apply clustering algorithms on extracted data</a></li>
                 <ul>
                   <li><a href="clustering.html#kmeans">3.2.1 KMeans</a></li>
                   <li><a href="clustering.html#kmedoids">3.2.2 KMedoids</a></li>
                   <li><a href="clustering.html#agglo">3.2.3 Agglomerative Clustering</a></li>
                   <li><a href="clustering.html#dbscan">3.2.4 DBscan</a></li>
                   <li><a href="clustering.html#fuzzyCmeans">3.2.5 Fuzzy Cmeans</a></li>
                 </ul>

               <li><a href="clustering.html#clust_results"> 3.3 Clustering results</a></li>
                  <ul>
                 <li><a href="clustering.html#clust_assign"><small>3.3.1 Cluster assignment</small></a></li>

                  <ul>
                   <li><a href="clustering.html#as_set"><small>3.3.1.1 Save results as set</small></a></li>
                   <li><a href="clustering.html#to_csv"><small>3.3.1.2 Export as CSV file</small></a></li>
                  </ul>

                 <li><a href="clustering.html#val_index"><small>3.3.2 Internal Validation Indexes</small></a></li>
                   <ul>
                     <li><a href="clustering.html#mean_silhouette"><small>3.3.2.1 Mean Silhouette</small></a></li>
                     <li><a href="clustering.html#ch_index"><small>3.3.2.2 Calinski-Habaraz Index</small></a></li>
                     <li><a href="clustering.html#db_index"><small>3.3.2.3 Davies Boulin index</small></a></li>
                     <li><a href="clustering.html#fpc"><small>3.3.2.4 Fuzzy Partition Coefficient</small></a></li>
                   </ul>


                  <li><a href="clustering.html#visu"><small>3.3.3 Graphic Visualisation</small></a></li>
                  <ul>
                    <li><a href="clustering.html#silhouette_graph"><small>3.3.3.1 Silhouette graph</small></a></li>
                    <li><a href="clustering.html#3d_view"><small>3.3.3.2 3D view</small></a></li>
                    <li><a href="clustering.html#cross_sections"><small>3.3.3.3 Cross sections</small></a></li>
                    <li><a href="clustering.html#glass_brain"><small>3.3.3.4 Glass brain</small></a></li>
                    <li><a href="clustering.html#dendrogramm"><small>3.3.3.5 Dendrogramm</small></a></li>
                  </ul>

                  <li><a href="clustering.html#nb_clusters">3.3.4 Choice the number of clusters</a></li>

                  <li><a href="clustering.html#iteration">3.3.5 Iteration</a></li>

               </ul>
            </ul>


            <li><a href="calculations.html"><strong>4 Calculations</strong></a></li>
			            <ul>

          	      <li><a href="calculations.html#41">4.1. Data extracted for calculation</a></li>
          	      <ul>
          		    <li><a href="calculations.html#411"><small>4.1.1. How data is extracted</small></a></li>
          	      </ul>

              	<li><a href="calculations.html#42">4.2. Optimization of calculations</a></li>
              	  <ul>
              		<li><a href="calculations.html#421"><small>4.2.1. Adapted library</small></a></li>
              		<li><a href="calculations.html#422"><small>4.2.2. Reduction of search space in data extraction</small></a></li>
              	  </ul>

              	<li><a href="calculations.html#43">4.3. List of implemented calcul</a></li>
		              <ul>
              		<li><a href="calculations.html#431"><small>4.3.1. Addition</small></a></li>
			            <li><a href="calculations.html#432"><small>4.3.2. Division</small></a></li>
              		<li><a href="calculations.html#433"><small>4.3.3. Linear combination</small></a></li>
            			<li><a href="calculations.html#434"><small>4.3.4. Mean</small></a></li>
            			<li><a href="calculations.html#435"><small>4.3.5. Multiplication</small></a></li>
            			<li><a href="calculations.html#436"><small>4.3.6. And</small></a></li>
            			<li><a href="calculations.html#437"><small>4.3.7. Or</small></a></li>
            			<li><a href="calculations.html#438"><small>4.3.8. Closing</small></a></li>
            			<li><a href="calculations.html#439"><small>4.3.9. Dilation</small></a></li>
            			<li><a href="calculations.html#4310"><small>4.3.10. Erosion</small></a></li>
            			<li><a href="calculations.html#4311"><small>4.3.11. Opening</small></a></li>
            			<li><a href="calculations.html#4312"><small>4.3.12. Threshold</small></a></li>
              	  </ul>

		            <li><a href="calculations.html#44">4.4. Procedure to apply a calculation</small></a></li>
                  <ul>
            			<li><a href="calculations.html#441"><small>4.4.1. Load and select a set of nifti collection</small></a></li>
            			<li><a href="calculations.html#442"><small>4.4.2. Select a calculation and the parameters</small></a></li>
              		<li><a href="calculations.html#443"><small>4.4.3. Execute the algorithm and save it in the calculation tab</small></a></li>
                </ul>

                  </ul>

            <li><a href="import_export.html"><strong>5 Import/Export</strong></a></li>
			       <ul>

             <li><a href="import_export.html#workspace">5.1 Workspace</a></li>
        			 <ul>
      				 <li><a href="import_export.html#what"><small>5.1.1 What is it?</small></a></li>
      				 <li><a href="import_export.html#export_workspace"><small>5.1.2 Export a workspace</small></a></li>
      				 <li><a href="import_export.html#import_workspace"><small>5.1.3 Import a workspace</small></a></li>
                </ul>

             <li><a href="import_export.html#export">5.2 Export an Image Collection</a></li>
        			 <ul>
      				 <li><a href="import_export.html#export_nifti"><small>5.2.1 As a NIfTI file</small></a></li>
      				 <li><a href="import_export.html#export_csv"><small>5.2.2 As a CSV file</small></a></li>
              </ul>
           </ul>

           <li><a href="som.html"><strong>6 Self-organizing map</strong></a></li>

            <ul>
             <li><a href="som.html#61">6.1 Self-organizing maps</a></li>

        			 <ul>
      				 <li><a href="som.html#611"><small>6.1.1. What are self-organizing maps ?</small></a></li>
      				 <li><a href="som.html#612"><small>6.1.2 Aim</small></a></li>
                </ul>

             <li><a href="som.html#62">6.2 6.1.1. Self-organizing in BrainMapper</a></li>
        			 <ul>
      				 <li><a href="som.html#621"><small>6.2.1 Parameters</small></a></li>
      				 <li><a href="som.html#622"><small>6.2.2 Training</small></a></li>
      				 <li><a href="som.html#623"><small>6.2.3 Graphs</small></a></li>
              </ul>
           </ul>

        	</ul>
    	</div>
    </div>
  </div>
  <div class="column-right">
    <div id="Global_presentation">
      <h1> Global presentation </h1>

      <p>
        During the year 2017-2018, an industrial project carried by TELECOM Nancy's students led to the creation of a first version of the software BrainMapper.
        This is the result of a 2-year collaboration between the Central Hospital of Nancy, France (CHRU in french) and computer science.
      </p>

      <p>
        The aim of this software is to help the understanding of the brain mecanisms threw the use of AI algorithms.
      </p>

      <p>
        BrainMapper simplifies the treatment chain used by neurosurgeons.
        Before BrainMapper, they had to use several librairies, software and methods to extract interesting data from NIfTI files.
        <br>
        The workchain of NIfTI processing and information extraction carried out by neurosurgeons was the following one :
      </p>

      <div style="padding-left: 24%; padding-top:3%; padding-bottom:3%">
        <img src="imgs/index/chaine.jpg" style="width:60%">
     </div>

     <p>
       The goal was to simplify this workchain and offer the possibility to manage NIfTI, extract the interesting data from them to use it for calculations and clustering algorithms.
       The workchain with BrainMapper is the next one :
     </p>

     <div style="padding-left: 24%; padding-top:3%; padding-bottom:3%">
       <img src="imgs/index/schema.png" style="width:65%">
     </div>

      <h2 id="usecase">1.1 Software usecase</h2>

      BrainMapper can be used to create several sets and image collections associated to brain responses or patients, that will contain different images,
      in the NIfTI format and standards (Excel, CSV).
      The user can then extract data from the loaded NIfTI files to perform basic calculations or apply clustering algorithms or self-organizing maps to this data.<br>
      Calculations and clustering results can be exported as NIfTI, Excel or CSV files, as well as the original NIfTI files.
      Data can be imported as well as NIfTI or Excel files and the user can specify
       a workspace directory from which files will be automatically imported.


      Thus, the current version of this software allows the user to : <br>
      <ul>
        <li><b>Open</b> NIfTI files (<em><b>'.nii'</b></em> or in compressed format <em><b>'.nii.gz'</b></em>) or CSV files ()<em><b>'.csv'</b></em>) or Excel files
          ()<em><b>'.xlsx'</b></em>) and put them in <b>Sets</b>, which are associated with a brain response and <b>Image Collections</b>, associated mostly to patients </li>
        <li>Import and export the workspace from/into a directory, whose structure will reflect that of the application (set folders, image collections subfolders...) </li>
        <li>Edit the content of sets and image collections (change their names, add or delete an image collection or a set)</li>
        <li>Visualize in a 3D graph the contents of a NIfTI image from the edition page </li>
        <li>Select several image collections, across all sets, containing the images to which calculations, clustering algorithms and self-organizing maps will be applied </li>
        <li>Perform several calculations on selected NIfTI files</li>
        <li>Extract data from selected NIfTI files and perform clustering methods on this data (KMeans, KMedoids, AgglomerativeClustering, DBscan, Fuzzy CMeans)</li>
        <li>Visualize clusters in a 3D graphic, on cross sections, on glass cross sections, the silhouette graphic or a dendogramm through graphical representations in clustering page</li>
        <li>Calculate <em><b>internal validation indexes</b></em> for clustering results, such as Mean Silhouette, Calinski-Habaraz score and Davis-Boulin index</li>
        <li>Save clustering and calculation results as sets and image collections within the application</li>
        <li>Export clustering assignments data table as a CSV file</li>
        <li>Export whole image collections or sets as NIfTI files</li>
        <li>Use self-organizing maps on Excel or CSV files</li>

      </ul>

      <h2 id="installation">1.2 BrainMapper installation</h2>

      <p>
        <em>BrainMapper</em> is written in Python 3.6 and its user interface is written in PyQt 4. In this section, we present a tutorial to use BrainMapper on your computer.
      </p>

      <p>If you are not familiar with informatics, we recommend running BrainMapper on Windows or Linux.
        Since the installation procedure is not automated for MacOS, you may need to adapt the instructions to your own environment.
      </p>

      <p>To begin an installation, you have to go in the installation folder.</p>

      <h3 id="windows">1.2.1 Windows </h3>

      <h4 id="executable">1.2.1.1 Executable file</h4>

      <p>
        An Windows executable file has been created.This one allows you to launch BrainMapper without having to install Python libraries and dependencies.
      </p>

      <p>To use it, you have to go in the Windows folder and to select the executable file. BrainMapper is launching and you can use it.</p>


      <h4 id="install_windows">1.2.1.2 Installation </h4>

      <h5>Python installation</h5>

      <p>
      You need to have python 3.6 to use this project.
      <br>
      Open the terminal (`Windows+r` and type `cmd`) and type the following line to
      check if python is installed
      <br>
      ```<br>
      python --version <br>
      ```
      </p>
      <p>
      If it is installed you should have the following result :
      <br>
      ```<br>
      Python 3.6.7 <br>
      ```<br>
      </p>

      <p>
      If the command does not work, it means that python is not installed.
      In this case, you can download it (<a href="https://www.python.org/downloads/release/python-367/" target="_blank" style="color : #5577ee">here</a>).
      During the install, ensure that the options "pip" and "tcl/tk" (on the screen Optional Features),
      "add Python to environment variables" (on the screen Advanced Options) are chosen.
      <br><br>
      You should be able to launch the previous command in a new terminal.
      </p>


      <h5>Dependencies installation</h5>

      <p>
      In the command line, install required dependencies with
      <br>
      ```
      <br>
      pip install -r <path to>\requirement.txt
      <br>
      ```
      </p>

      <p>
      You also have to download pyqt4 (<a href="https://www.lfd.uci.edu/~gohlke/pythonlibs/#pyqt4" target="_blank" style="color : #5577ee">here</a>), download PyQt4-4.11.4-cp36-cp36m-win_amd64.whl
      Then install it with pip <br>
      <br>
      ```<br>
      pip install <path to>\PyQt4‑4.11.4‑cp36‑cp36m‑win32.whl <br>
      ```<br>
      </p>

      <p>
      For example : <br>
      ```<br>
      pip install -r C:\Users\Me\BrainMapperV2\installation\Windows\requirement.txt <br>
      pip install C:\Users\Me\Downloads\PyQt4-4.11.4-cp36-cp36m-win_amd64.whl <br>
      <br>
      ```
      </p>

      <h5>Launching BrainMapper</h5>

      <p>
      In the command line, set your current directory at the root of BrainMapper <br>
      ``` <br>
      cd <i>path to</i>\BrainMapperV2 <br>
      ```
      </p>

      <p>
      Start the script with python <br>
      ``` <br>
      python UI.py <br>
      ```
      </p>

      <p>
      For example : <br>
      ``` <br>
      cd C:\Users\Me\BrainMapperV2 <br>
      python UI.py <br>
      ```
      </p>

        <h3 id="mac">1.2.2 OSX/Mac</h3>

        <h5>Python installation</h5>

        <p>
          If python3 is not already install on your computer, you need to download it.
          To download the installer, click
          <a href="https://www.python.org/ftp/python/3.6.5/python-3.6.5-macosx10.9.pkg" target="_blank" style="color : #5577ee">here</a>
        </p>

        <h5>Python paths</h5>

        <p>
          To install the dependencies, open a terminal in the MacOS folder.
          For the installation, you will need to note the folders where python3 and python3 dependencies are installed :
          <br><br>
          <b><i>_Python3 folder_:</i></b>
          <br>
          ```shell <br>
          $ which python3 <br>
          ```
          <br><br>
          For exemple if you get /usr/bin/python3, python3 folder is /urs/bin/.
          <br><br>
        </p>

        <p>
          <b><i>_Dependencies folder_ :</i></b>
          <br>
          ```shell
          <br>
          $ echo `pip3 show pip | grep "Location" | grep -oE "[^ ]+$"`
          <br>
          ```
          <br>
          (for exemple /usr/lib/python3/dist-packages)
          <br> <br>
          Install brew following the official website clicking
          <a href="https://brew.sh/" target="_blank" style="color : #5577ee">here</a>
          <br>
          <br>
          Then install Qt4 (brew is needed):
          <br>
          ```<br>
          $ brew tap cartr/qt4 <br>
          $ brew tap-pin cartr/qt4 <br>
          $ brew install qt@4 <br>
          ```
        </p>

          <h5>Sip installation</h5>
          <p>
          ```shell
          <br>
          $ curl -L -O https://sourceforge.net/projects/pyqt/files/sip/sip-4.19.13/sip-4.19.13.tar.gz
          <br>
          $ tar -xvf sip-4.19.13.tar.gz
          <br>
          $ cd sip-4.19.13
          <br>
          $ python3 configure.py -b ../temp_sip -v ../temp_sip -d ../temp_sip -e ../temp_sip
          <br>
          $ make install
          <br>
          $ cd ../temp_sip
          <br>
          $ cp sip.so <i>Dependencies folder</i>
          <br>
          $ cp -r sip-4.19.13.dist-info <i>Dependencies folder</i>
          <br>
          $ cd ..
          <br>
          ```
        </p>

          <h5>PyQt4 installation</h5>
          <p>
          ```shell <br>
          $ curl -L -O https://sourceforge.net/projects/pyqt/files/PyQt4/PyQt-4.12/PyQt4_gpl_mac-4.12.tar.gz <br>
          $ tar -xvf PyQt4_gpl_mac-4.12.tar.gz <br>
          $ QMAKESPEC=unsupported/macx-clang-libc++ <br>
          $ cd PyQt4_gpl_mac-4.12 <br>
          $ python3 configure-ng.py --sip ../temp_sip/sip --no-stubs --bindir <i>Python3 folder</i>  --destdir <i>Dependencies folder</i> --sip-incdir=../temp_sip <br>
          $ make install <br>
          $ cd .. <br>
          ```
          </p>

          <h5>Other dependencies installation</h5>
          <p>
          ```shell
          <br>
          $ python3 -m pip install -r requirement.txt
          <br>
          $ python3 -m pip install scipy==1.1.0
          <br>
          $ python3 -m pip install tensorflow==1.5.0
          <br>
          ```
        </p>

        <h5>Launching BrainMapper</h5>

        <p>
          Then, you can launch BrainMapper with the following command from the root folder:
          <br><br>
          ```shell
          <br>
          $ python3 UI.py
          <br>
          ```
        </p>

        <h3 id="ubuntu">1.2.3 Ubuntu/GNU/Linux</h3>

        <h5>Intallation</h5>

        <p>
          To install the dependencies, you have to go in the Linux folder and to launch the installation script with the following instructions :
          <br><br>
          ```shell
          <br>
          $ chmod +x install.sh
          <br>
          $ ./install.sh
          <br>
          ```
        </p>

        <h5>Launching BrainMapper</h5>

        <p>
          Then you can launch BrainMapper with the following command from the root folder :
          <br><br>
          ```shell
          <br>
          $ python3 UI.py
          <br>
          ```
        </p>

        <p>Now, you can use BrainMapper.</p>

      <h3 id="virtual_envir">1.2.4 Virtual environment</h3>

      <p>
        First you need to download the VirtualBox software on your computer :
        MacOS :
        <a href="https://download.virtualbox.org/virtualbox/6.0.4/VirtualBox-6.0.4-128413-OSX.dmg" target="_blank">here</a> <br>
        Windows :
        <a href="https://download.virtualbox.org/virtualbox/6.0.4/VirtualBox-6.0.4-128413-Win.exe" target="_blank">here</a> <br>
        Linux :
        <a href="https://download.virtualbox.org/virtualbox/6.0.4/virtualbox-6.0_6.0.4-128413~Ubuntu~bionic_amd64.deb" target="_blank">here</a> <br>
        (other Linux distributions :
        <a href="https://www.virtualbox.org/wiki/Linux_Downloads" target="_blank">here</a>)
      </p>

      <p>
        Open VirtualBox and click on the "File" menu. <br>
        <img src="imgs/index/tuto1.png" style="width:30%"> <br> <br>
        Click on import appliance and chose BrainMapper.ova. Click on next.  <br>
        After the import, you can change the setings or leave the default ones. <br>
        Then you just have to start the machine selected by clicking on the "Start" button. <br>
        The password of the machine is : brainmapper <br>
      </p>

      <h3 id="dependancies">1.2.5 Dependencies </h3>

      <p>All dependencies are listed in the file named requirement.txt.</p>

      <p>
        Here are the main Python libraries used for BrainMapper :
        <ul>
          <li>matplotlib (==3.0.2)</li>
          <li>neupy (==0.8.0)</li>
          <li>nibabel (==2.3.1)</li>
          <li>nilearn (==0.5.0)</li>
          <li>numpy (==1.15.4)</li>
          <li>pandas (==0.23.4)</li>
          <li>PyOpenGL (==3.1.0)</li>
          <li>pyqtgraph (==0.10.0)</li>
          <li>scikit-learn (=0.20.0)</li>
        </ul>
      </p>

    </div>
  </div>
</div>


	<footer class="w3-container w3-dark-grey w3-padding-32 w3-margin-top">
    <div class="column-left">
	     <p>Source code available on <a href="https://github.com/Brain-Mapper/brainMapper" target="_blank">GitHub repository</a></p>
    </div>
    <div>
      <p> <b>Authors</b>: R. Agathon (@yoshcraft), M. Cluchague (@maximeCluchague), G. Husson (@Graziella-Husson), V. Zelaya (@vz-chameleon),
      M. Adler (@MarieAdler), A. Benoit (@BenAur), T. Grassellini (@GrasselliniThomas), L. Martin (@MartinLucie)
    </div>
	</footer>
  </body>
</html>
